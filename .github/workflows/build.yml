name: Build Windows Exe
# Định nghĩa sự kiện kích hoạt
on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # Cho phép bấm nút chạy thủ công

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3

      # 1. Cài Java 17 (để có jpackage)
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # 2. Compile code Java
      - name: Compile Java
        run: |
          mkdir out
          javac -d out -encoding UTF-8 src/main/java/VideoDownloaderGUI.java

      # 3. Copy file ffmpeg.exe (Win) vào thư mục build
      # LƯU Ý: Bạn phải đảm bảo file ffmpeg.exe đã nằm trong src/main/resources trên Git
      - name: Copy Resources
        run: |
          copy src\main\resources\ffmpeg.exe out\ffmpeg.exe

      # 4. Tạo file JAR
      - name: Build JAR
        run: |
          echo Main-Class: VideoDownloaderGUI > manifest.txt
          jar cfe app.jar VideoDownloaderGUI -C out .

      - name: Prepare Staging
        run: |
          mkdir staging
          copy app.jar staging\app.jar

      # 5. Dùng jpackage tạo file EXE
      - name: Build EXE with JPackage
        run: jpackage --input . --name "ToolTaiVideo" --main-jar app.jar --main-class VideoDownloaderGUI --type app-image --win-console

      # 6. Nén kết quả
      - name: Zip Result
        run: compress-archive -Path ToolTaiVideo -DestinationPath ToolTaiVideo_Win.zip

      # 7. Upload để tải về
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Tool-Tai-Video-Windows
          path: ToolTaiVideo_Win.zip